<div class="log-source-reference-dialog">
  <h1>{{ isNew ? 'Add' : 'Edit' }} Log Source Reference</h1>

  <!-- data component autocomplete -->
  <mat-form-field appearance="outline">
    <mat-label>Data Component</mat-label>
    <input
      matInput
      [matAutocomplete]="auto"
      [formControl]="dataComponentCtrl"
      required />
    <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayWith">
      @for (dataComponent of filteredDataComponents$ | async; track $index) {
        <mat-option [value]="dataComponent">
          <span>{{ dataComponent.name }}</span> |
          <small>{{ dataComponent.attackID || 'unknown' }}</small>
        </mat-option>
      }
    </mat-autocomplete>
  </mat-form-field>

  <!-- log source name and channel dropdown -->
  <mat-form-field appearance="outline">
    <mat-label>log source name and channel</mat-label>
    <mat-select [formControl]="logSourceCtrl">
      <mat-select-trigger>
        <!-- custom display for the selected value -->
        <ng-container *ngIf="logSourceCtrl.value as selected">
          <span class="text-deemphasis">name:</span> {{ selected.name }},
          <span class="text-deemphasis">channel:</span> {{ selected.channel }}
        </ng-container>
      </mat-select-trigger>
      @for (logSource of logSources; track logSource) {
        <mat-option
          [value]="logSource"
          [disabled]="isAlreadyReferenced(logSource)">
          <span class="text-deemphasis">name:</span> {{ logSource.name }},
          <span class="text-deemphasis">channel:</span> {{ logSource.channel }}
          <span
            *ngIf="isAlreadyReferenced(logSource)"
            style="font-size: 0.9em; margin-left: 8px">
            (Already referenced)
          </span>
        </mat-option>
      }
    </mat-select>
  </mat-form-field>

  <!-- cancel/confirm -->
  <div class="buttons">
    <button mat-button matDialogClose>cancel</button>
    <button mat-stroked-button [disabled]="!isValid()" (click)="confirm()">
      confirm
    </button>
  </div>
</div>
